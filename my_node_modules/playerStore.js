var Promise = Promise || require("bluebird");


var startingGold = 1000;
/**
 * Interacts with player state
 * Requires knex when loaded
 */
module.exports = function (knex) {
    this.knex = knex;


    return {
        /**
        * Register a new user if no entry exists
        */
        create: function (email, name){
            return knex("users")
            .where("email", email)
            .select("*")
            .then(function (rows){
                //if this entry does not exist, add it
                if (rows.length === 0) {
                    return knex('users')
                    .insert({
                        email: email,
                        name: name, 
                    }).returning("id");
                } else { //if it does exist, do no add it
                    return rows[0].id;
                }
            });
        },
        /**
        * Get playerInfo base on ID
        */
        get: function (id){
            return knex("users")
            .where("id", id)
            .select("*")
            .then(function (rows){
                return rows[0];
            })
        },
        getAll: function (){
            return knex("users")
            .select("*")
            .then(function (rows){
                return rows;
            })
        },
        getByEmail: function (email){
            return knex("users")
            .where("email", email)
            .select("*")
            .then(function (rows){
                return rows[0];
            })
        },
    };
};